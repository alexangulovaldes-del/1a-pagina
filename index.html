<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ruleta — Juego</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="reset.css">
</head>
<body>
    <header>
        <h1>Ruleta Mágica</h1>
    </header>

    <main>
        <section class="game">
            <div class="roulette-area">
                <div id="wheel" class="wheel" aria-hidden="true"></div>
                <div class="marker" aria-hidden="true">▼</div>
            </div>

            <aside class="controls" aria-label="Panel de apuestas">
                <div class="balance">Saldo: <span id="balance">1000</span> €</div>

                <div class="bet-slip">
                    <div style="display:flex;gap:8px;margin-bottom:8px;align-items:center;">
                        <input id="betAmount" type="number" min="1" value="10" style="flex:1;" />
                        <select id="betType" style="width:160px;">
                            <option value="number">Número (Straight)</option>
                            <option value="color">Color (Rojo/Negro)</option>
                            <option value="parity">Par / Impar</option>
                            <option value="highlow">Bajo / Alto (1-18 / 19-36)</option>
                            <option value="dozen">Docena (1-12 / 13-24 / 25-36)</option>
                        </select>
                    </div>

                    <div class="bet-row" style="margin-bottom:8px;">
                        <input id="choiceInput" placeholder="Elección (ej. 7, rojo, par, alto, 2)" style="flex:1;" />
                        <button id="addBet" class="btn-primary" style="margin-left:8px;">Añadir apuesta</button>
                    </div>

                    <div class="bet-table" id="betTable" aria-hidden="false"></div>

                    <div class="bet-slip">
                        <div class="bets-list" id="betsList"></div>
                        <div class="bet-summary">
                            <div>Total apuesta: <strong id="totalStake">0</strong> €</div>
                            <div style="display:flex;gap:8px;"><button id="clearBets" class="btn-danger">Borrar</button><button id="spinBtn" class="btn-primary">Girar</button></div>
                        </div>
                    </div>
                </div>

                <div id="result" class="result" role="status" aria-live="polite">Listo — añade apuestas y pulsa Girar.</div>
                <div class="muted" style="margin-top:8px">Haz clic en un número del recuadro o usa "Añadir apuesta".</div>
            </aside>
        </section>

        <section class="instructions">
            <h2>Cómo funciona</h2>
            <p>Se simula una ruleta europea (0–36). Pagos estándar: <strong>Straight (número)</strong> 35:1, <strong>Docena</strong> 2:1, <strong>Color/Par/Impar/Alto-Bajo</strong> 1:1.</p>
        </section>
    </main>

    <footer>
        <p>Proyecto de ejemplo — Derechos reservados</p>
    </footer>

    <div class="shape shape--1" aria-hidden="true"></div>
    <div class="shape shape--2" aria-hidden="true"></div>
    <div class="shape shape--3" aria-hidden="true"></div>

    <script>
    (function(){
        // European wheel sequence (0 then following pockets clockwise)
        const wheelNumbers = [0,32,15,19,4,21,2,25,17,34,6,27,13,36,11,30,8,23,10,5,24,16,33,1,20,14,31,9,22,18,29,7,28,12,35,3,26];
        const N = wheelNumbers.length;
        const wheel = document.getElementById('wheel');
        const spinBtn = document.getElementById('spinBtn');
        const addBetBtn = document.getElementById('addBet');
        const clearBetsBtn = document.getElementById('clearBets');
        const resultEl = document.getElementById('result');
        const betAmount = document.getElementById('betAmount');
        const betType = document.getElementById('betType');
        const choiceInput = document.getElementById('choiceInput');
        const balanceEl = document.getElementById('balance');
        const betsListEl = document.getElementById('betsList');
        const betTableEl = document.getElementById('betTable');
        const totalStakeEl = document.getElementById('totalStake');

        const sectorAngle = 360 / N;
        let balance = 1000;
        let bets = [];

        // Determine colors by wheel order: 0 is green, then alternate red/black
        const colors = [];
        for(let i=0;i<N;i++){
            const num = wheelNumbers[i];
            if(num === 0) colors.push('green');
            else colors.push((colors.length && colors[colors.length-1] === 'red') ? 'black' : 'red');
        }

        // build wheel segments using wheelNumbers order
        const gradientParts = [];
        for(let i=0;i<N;i++){
            const col = (colors[i] === 'green') ? '#1b5e20' : (colors[i] === 'red' ? '#c62828' : '#111');
            const start = i*sectorAngle;
            const end = (i+1)*sectorAngle;
            gradientParts.push(`${col} ${start}deg ${end}deg`);
        }
        wheel.style.background = `conic-gradient(${gradientParts.join(',')})`;

        // labels (numbers) positioned according to wheel ordering
        for(let i=0;i<N;i++){
            const label = document.createElement('span');
            label.className = 'wheel-label';
            label.dataset.pos = i;
            const angle = i*sectorAngle + sectorAngle/2;
            label.textContent = wheelNumbers[i];
            label.style.transform = `rotate(${angle}deg) translateY(-45%) rotate(${-angle}deg)`;
            label.title = `Número ${wheelNumbers[i]}`;
            label.addEventListener('click', ()=>{
                // quick add number bet
                choiceInput.value = String(wheelNumbers[i]);
                betType.value = 'number';
            });
            wheel.appendChild(label);
        }

        // build bet table (visual grid for quick clicks)
        function buildBetTable(){
            betTableEl.innerHTML = '';
            // show 0 separately then grid 1..36
            const zeroCell = document.createElement('div');
            zeroCell.className = 'bet-cell green';
            zeroCell.textContent = '0';
            zeroCell.addEventListener('click', ()=>{ choiceInput.value='0'; betType.value='number'; });
            betTableEl.appendChild(zeroCell);

            for(let i=1;i<=36;i++){
                // find position and color from wheelNumbers
                const pos = wheelNumbers.indexOf(i);
                const col = colors[pos] === 'red' ? 'red' : 'black';
                const c = document.createElement('div');
                c.className = `bet-cell ${col}`;
                c.textContent = String(i);
                c.addEventListener('click', ()=>{ choiceInput.value=String(i); betType.value='number'; });
                betTableEl.appendChild(c);
            }
        }
        buildBetTable();

        function refreshBetsUI(){
            betsListEl.innerHTML = '';
            let total = 0;
            bets.forEach((b, idx)=>{
                const item = document.createElement('div'); item.className = 'bet-item';
                item.innerHTML = `<div>${b.type}: <strong>${b.choice}</strong></div><div>${b.amount} €</div>`;
                const rem = document.createElement('button'); rem.textContent='X'; rem.className='btn-danger'; rem.style.padding='4px 6px'; rem.addEventListener('click', ()=>{ bets.splice(idx,1); refreshBetsUI(); });
                item.appendChild(rem);
                betsListEl.appendChild(item);
                total += b.amount;
            });
            totalStakeEl.textContent = total.toFixed(2);
        }

        addBetBtn.addEventListener('click', ()=>{
            const amt = Number(betAmount.value) || 0;
            if(amt <= 0){ alert('Introduce una cantidad válida'); return; }
            const type = betType.value;
            const choice = choiceInput.value.trim();
            if(type === 'number'){
                const n = Number(choice);
                if(Number.isNaN(n) || n < 0 || n > 36){ alert('Número entre 0 y 36'); return; }
            }
            bets.push({type, choice, amount: amt});
            refreshBetsUI();
        });

        clearBetsBtn.addEventListener('click', ()=>{ bets = []; refreshBetsUI(); });

        function setRotation(deg, duration=6000){
            wheel.style.transition = `transform ${duration}ms cubic-bezier(0.15, 0.9, 0.25, 1)`;
            wheel.style.transform = `rotate(${deg}deg)`;
        }

        function getWinnerPositionFromFinal(finalDeg){
            const r = ((360 - (finalDeg % 360)) % 360);
            return Math.floor((r + 0.0001) / sectorAngle) % N;
        }

        function randomInt(max){ return Math.floor(Math.random()*max); }

        function payoutForBet(winnerNumber, bet){
            const res = {won:false, net:0};
            const n = Number(winnerNumber);
            switch(bet.type){
                case 'number':
                    if(Number(bet.choice) === n){ res.won = true; res.net = bet.amount * 35; }
                    break;
                case 'color':
                    // identify color of winner
                    const pos = wheelNumbers.indexOf(n);
                    const winColor = (n===0)?'green':colors[pos];
                    if(bet.choice.toLowerCase() === winColor) { res.won = true; res.net = bet.amount * 1; }
                    break;
                case 'parity':
                    if(n !== 0){
                        if(bet.choice.toLowerCase()==='par' && n%2===0){ res.won=true; res.net = bet.amount *1; }
                        if(bet.choice.toLowerCase()==='impar' && n%2===1){ res.won=true; res.net = bet.amount *1; }
                    }
                    break;
                case 'highlow':
                    if(n !== 0){
                        if(bet.choice.toLowerCase()==='alto' && n>=19 && n<=36){ res.won=true; res.net = bet.amount *1; }
                        if(bet.choice.toLowerCase()==='bajo' && n>=1 && n<=18){ res.won=true; res.net = bet.amount *1; }
                    }
                    break;
                case 'dozen':
                    if(n !== 0){
                        if(bet.choice==='1' && n>=1 && n<=12){ res.won=true; res.net = bet.amount *2; }
                        if(bet.choice==='2' && n>=13 && n<=24){ res.won=true; res.net = bet.amount *2; }
                        if(bet.choice==='3' && n>=25 && n<=36){ res.won=true; res.net = bet.amount *2; }
                    }
                    break;
            }
            return res;
        }

        function createConfetti(){
            const count = 40;
            for(let i=0;i<count;i++){
                const d = document.createElement('div');
                d.className = 'confetti-piece';
                d.style.background = (i%2===0)?'#ffd36b':'#6bffb3';
                d.style.left = (window.innerWidth/2 + (randomInt(400)-200)) + 'px';
                d.style.top = (window.innerHeight/4) + 'px';
                document.body.appendChild(d);
                requestAnimationFrame(()=>{
                    const tx = (randomInt(800)-400);
                    const ty = (randomInt(600)+200);
                    const rot = randomInt(720);
                    d.style.transition = 'transform 1400ms ease-out, opacity 1400ms ease-out';
                    d.style.transform = `translate(${tx}px, ${ty}px) rotate(${rot}deg)`;
                    d.style.opacity = '0';
                });
                setTimeout(()=> d.remove(), 1600);
            }
        }

        function spin(){
            if(bets.length === 0){ alert('Añade al menos una apuesta antes de girar'); return; }
            const totalStake = bets.reduce((s,b)=> s + b.amount, 0);
            if(totalStake > balance){ alert('Saldo insuficiente'); return; }
            // deduct stakes
            balance -= totalStake;
            balanceEl.textContent = balance.toFixed(2);

            spinBtn.disabled = true; addBetBtn.disabled = true; clearBetsBtn.disabled = true;
            resultEl.textContent = 'Girando...';

            const winnerPos = randomInt(N);
            const spins = 5 + randomInt(4);
            const finalDeg = spins*360 + winnerPos*sectorAngle + sectorAngle/2;
            setRotation(finalDeg, 6000);

            const onEnd = ()=>{
                wheel.style.transition = '';
                const landedPos = getWinnerPositionFromFinal(finalDeg);
                const winnerNumber = wheelNumbers[landedPos];

                // highlight winner
                wheel.querySelectorAll('.wheel-label').forEach(l=> l.classList.remove('winner'));
                const winnerLabel = wheel.querySelector(`.wheel-label[data-pos='${landedPos}']`);
                if(winnerLabel) winnerLabel.classList.add('winner');

                // evaluate bets
                let messageParts = [];
                let anyWin = false;
                bets.forEach(b=>{
                    const p = payoutForBet(winnerNumber, b);
                    if(p.won){ anyWin = true; balance += b.amount + p.net; messageParts.push(`Ganaste ${p.net} € en ${b.type} (${b.choice})`); }
                    else { messageParts.push(`Perdiste ${b.amount} € en ${b.type} (${b.choice})`); }
                });
                resultEl.textContent = `Resultado: ${winnerNumber}. ` + messageParts.join(' — ');
                totalStakeEl.textContent = '0';
                bets = []; refreshBetsUI();
                balanceEl.textContent = balance.toFixed(2);

                if(anyWin) createConfetti();

                spinBtn.disabled = false; addBetBtn.disabled = false; clearBetsBtn.disabled = false;
                wheel.removeEventListener('transitionend', onEnd);
            };
            wheel.addEventListener('transitionend', onEnd);
        }

        function getWinnerPositionFromFinal(finalDeg){
            return Math.floor(((360 - (finalDeg % 360)) % 360 + 0.0001) / sectorAngle) % N;
        }

        spinBtn.addEventListener('click', spin);

        // init UI
        refreshBetsUI();
        balanceEl.textContent = balance.toFixed(2);
        resultEl.textContent = 'Listo — añade apuestas y pulsa Girar.';

    })();
    </script>
</body>
</html>