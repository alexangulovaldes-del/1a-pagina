<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ruleta Europea</title>
    <link rel="stylesheet" href="reset.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <h1>RULETA EUROPEA</h1>
    </header>

    <main>
        <!-- Ruleta -->
        <section class="roulette-area">
            <div class="marker">▼</div>
            <div id="wheel" class="wheel">
                <div class="wheel-inner" id="wheelInner">
                    <div id="ball" class="ball"></div>
                </div>
            </div>
        </section>

        <!-- Tablero de apuestas -->
        <section class="bet-board">
            <div class="game-info">
                <div class="balance">Saldo: <span id="balance">1000</span> €</div>
                <div class="stake-input">
                    <label for="stakeAmount">Apuesta:</label>
                    <input id="stakeAmount" type="number" min="1" value="10">
                    <span>€</span>
                </div>
            </div>

            <!-- Números 0-36 -->
            <div class="bet-section-label">Números</div>
            <div class="bet-grid" id="numbersGrid"></div>

            <!-- Color -->
            <div class="bet-section-label">Color</div>
            <div class="bet-grid">
                <div class="bet-cell red" data-bet="color" data-choice="red">ROJO</div>
                <div class="bet-cell black" data-bet="color" data-choice="black">NEGRO</div>
            </div>

            <!-- Par/Impar -->
            <div class="bet-section-label">Par / Impar</div>
            <div class="bet-grid">
                <div class="bet-cell other" data-bet="parity" data-choice="even">PAR</div>
                <div class="bet-cell other" data-bet="parity" data-choice="odd">IMPAR</div>
            </div>

            <!-- Bajo/Alto -->
            <div class="bet-section-label">Bajo / Alto (1-18 / 19-36)</div>
            <div class="bet-grid">
                <div class="bet-cell other" data-bet="highlow" data-choice="low">BAJO (1-18)</div>
                <div class="bet-cell other" data-bet="highlow" data-choice="high">ALTO (19-36)</div>
            </div>

            <!-- Docenas -->
            <div class="bet-section-label">Docenas</div>
            <div class="bet-grid">
                <div class="bet-cell other" data-bet="dozen" data-choice="1">1ª DOCENA (1-12)</div>
                <div class="bet-cell other" data-bet="dozen" data-choice="2">2ª DOCENA (13-24)</div>
                <div class="bet-cell other" data-bet="dozen" data-choice="3">3ª DOCENA (25-36)</div>
            </div>

            <!-- Columnas -->
            <div class="bet-section-label">Columnas</div>
            <div class="bet-grid">
                <div class="bet-cell other" data-bet="column" data-choice="1">COL 1</div>
                <div class="bet-cell other" data-bet="column" data-choice="2">COL 2</div>
                <div class="bet-cell other" data-bet="column" data-choice="3">COL 3</div>
            </div>

            <!-- Resultado -->
            <div id="result" class="result">Haz clic en un número o en una opción para apostar. Pulsa GIRAR para comenzar.</div>

            <!-- Controles -->
            <div class="controls" style="margin-top: 2rem;">
                <button id="spinBtn">GIRAR</button>
                <button id="clearBets">BORRAR APUESTAS</button>
            </div>
        </section>
    </main>

    <footer>
        <p>Ruleta Europea - Pagos: Número 35:1 | Docena 2:1 | Color/Par/Impar/Bajo-Alto 1:1 | Columna 2:1</p>
    </footer>

    <div class="shape shape--1"></div>
    <div class="shape shape--2"></div>
    <div class="shape shape--3"></div>

    <script>
    (function(){
        const wheelNumbers = [0,32,15,19,4,21,2,25,17,34,6,27,13,36,11,30,8,23,10,5,24,16,33,1,20,14,31,9,22,18,29,7,28,12,35,3,26];
        const N = wheelNumbers.length;
        const sectorAngle = 360 / N;

        const wheel = document.getElementById('wheel');
        const wheelInner = document.getElementById('wheelInner');
        const ball = document.getElementById('ball');
        const spinBtn = document.getElementById('spinBtn');
        const clearBetsBtn = document.getElementById('clearBets');
        const resultEl = document.getElementById('result');
        const stakeInput = document.getElementById('stakeAmount');
        const balanceEl = document.getElementById('balance');
        const numbersGrid = document.getElementById('numbersGrid');

        let balance = 1000;
        let bets = [];
        let isSpinning = false;

        // Determine colors: 0 is green, then alternating red/black
        const numberColor = {};
        const reds = [1,3,5,7,9,12,14,16,18,19,21,23,25,27,30,32,34,36];
        for(let i = 0; i <= 36; i++){
            if(i === 0) numberColor[i] = 'green';
            else numberColor[i] = reds.includes(i) ? 'red' : 'black';
        }

        // Build wheel with conic gradient
        const gradientStops = [];
        for(let i = 0; i < N; i++){
            const num = wheelNumbers[i];
            const color = numberColor[num] === 'red' ? '#c62828' : (numberColor[num] === 'green' ? '#1b5e20' : '#111');
            const start = i * sectorAngle;
            const end = (i + 1) * sectorAngle;
            gradientStops.push(`${color} ${start}deg ${end}deg`);
        }
        wheelInner.style.background = `conic-gradient(${gradientStops.join(',')})`;

        // Add numbers to wheel
        wheelNumbers.forEach((num, idx) => {
            const label = document.createElement('div');
            label.className = 'wheel-label';
            const angle = idx * sectorAngle + sectorAngle / 2;
            const rad = (angle * Math.PI) / 180;
            const radius = 210;
            const x = Math.cos(rad) * radius;
            const y = Math.sin(rad) * radius;
            label.textContent = num;
            label.style.left = `calc(50% + ${x}px)`;
            label.style.top = `calc(50% + ${y}px)`;
            label.style.transform = 'translate(-50%, -50%)';
            wheelInner.appendChild(label);
        });

        // Build numbers grid
        for(let i = 0; i <= 36; i++){
            const cell = document.createElement('div');
            cell.className = `bet-cell number`;
            if(numberColor[i] === 'red') cell.classList.add('red');
            else if(numberColor[i] === 'black') cell.classList.add('black');
            else cell.classList.add('green');
            cell.textContent = i;
            cell.dataset.bet = 'number';
            cell.dataset.choice = String(i);
            numbersGrid.appendChild(cell);
        }

        // Click handlers for all bet cells
        document.querySelectorAll('.bet-cell').forEach(cell => {
            cell.addEventListener('click', () => {
                if(isSpinning) return;
                const betType = cell.dataset.bet;
                const choice = cell.dataset.choice;
                const stake = Number(stakeInput.value) || 0;
                if(stake <= 0){ alert('Introduce una cantidad válida'); return; }
                bets.push({type: betType, choice, amount: stake});
                updateBetsDisplay();
            });
        });

        function updateBetsDisplay(){
            const total = bets.reduce((s, b) => s + b.amount, 0);
            resultEl.textContent = `Apuestas activas: ${bets.length} | Total: ${total} €`;
        }

        clearBetsBtn.addEventListener('click', () => {
            bets = [];
            updateBetsDisplay();
        });

        function spin(){
            if(isSpinning || bets.length === 0){ alert('Añade al menos una apuesta'); return; }
            const totalStake = bets.reduce((s, b) => s + b.amount, 0);
            if(totalStake > balance){ alert('Saldo insuficiente'); return; }

            isSpinning = true;
            spinBtn.disabled = true;
            clearBetsBtn.disabled = true;
            balance -= totalStake;
            balanceEl.textContent = balance;
            resultEl.textContent = 'Girando...';

            const winnerIdx = Math.floor(Math.random() * N);
            const winnerNumber = wheelNumbers[winnerIdx];
            const spins = 5 + Math.floor(Math.random() * 4);
            const finalRotation = spins * 360 + winnerIdx * sectorAngle + sectorAngle / 2;

            // Animate wheel
            wheelInner.style.transition = 'transform 6s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
            wheelInner.style.transform = `rotate(${finalRotation}deg)`;

            // Animate ball opposite direction
            const ballSpins = spins * 8 + Math.floor(Math.random() * 6);
            ball.style.transition = 'transform 5.8s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
            ball.style.transform = `rotate(${-(ballSpins * 360)}deg) translateY(-230px) rotate(${ballSpins * 360}deg)`;

            setTimeout(() => {
                wheelInner.style.transition = '';
                ball.style.transition = '';

                // Evaluate bets
                let totalWin = 0;
                let messages = [];
                bets.forEach(bet => {
                    const payout = calculatePayout(winnerNumber, bet);
                    if(payout > 0){
                        totalWin += payout;
                        messages.push(`✓ ${bet.type}: ${bet.choice} → +${payout} €`);
                    } else {
                        messages.push(`✗ ${bet.type}: ${bet.choice} → -${bet.amount} €`);
                    }
                });

                balance += totalWin;
                balanceEl.textContent = balance;
                resultEl.innerHTML = `<strong>Número ganador: ${winnerNumber}</strong><br>` + messages.join('<br>');

                if(totalWin > 0) createConfetti();

                bets = [];
                isSpinning = false;
                spinBtn.disabled = false;
                clearBetsBtn.disabled = false;
            }, 6200);
        }

        function calculatePayout(winner, bet){
            const n = Number(winner);
            let won = false;

            switch(bet.type){
                case 'number':
                    won = (Number(bet.choice) === n);
                    return won ? bet.amount * 35 : 0;
                case 'color':
                    won = (numberColor[n] === bet.choice);
                    return won ? bet.amount : 0;
                case 'parity':
                    if(n === 0) return 0;
                    won = ((bet.choice === 'even' && n % 2 === 0) || (bet.choice === 'odd' && n % 2 === 1));
                    return won ? bet.amount : 0;
                case 'highlow':
                    if(n === 0) return 0;
                    won = ((bet.choice === 'low' && n <= 18) || (bet.choice === 'high' && n >= 19));
                    return won ? bet.amount : 0;
                case 'dozen':
                    if(n === 0) return 0;
                    const dozen = bet.choice;
                    won = ((dozen === '1' && n <= 12) || (dozen === '2' && n >= 13 && n <= 24) || (dozen === '3' && n >= 25));
                    return won ? bet.amount * 2 : 0;
                case 'column':
                    if(n === 0) return 0;
                    const col = Number(bet.choice);
                    won = (n % 3 === (col % 3));
                    return won ? bet.amount * 2 : 0;
            }
            return 0;
        }

        function createConfetti(){
            for(let i = 0; i < 50; i++){
                const conf = document.createElement('div');
                conf.className = 'confetti';
                conf.style.left = Math.random() * window.innerWidth + 'px';
                conf.style.top = '-10px';
                conf.style.width = '10px';
                conf.style.height = '10px';
                conf.style.background = ['#ffd36b', '#2ecc71', '#e74c3c'][Math.floor(Math.random() * 3)];
                document.body.appendChild(conf);

                const duration = 2 + Math.random() * 1;
                const tx = (Math.random() - 0.5) * 400;
                const ty = window.innerHeight + 20;
                conf.style.animation = `fall ${duration}s linear forwards`;
                conf.style.setProperty('--tx', tx + 'px');
                conf.style.setProperty('--ty', ty + 'px');

                setTimeout(() => conf.remove(), duration * 1000);
            }
        }

        spinBtn.addEventListener('click', spin);
        updateBetsDisplay();
        balanceEl.textContent = balance;

        // Add fall animation to stylesheet
        const style = document.createElement('style');
        style.textContent = `
            @keyframes fall {
                to { transform: translateY(var(--ty)) translateX(var(--tx)) rotate(720deg); opacity: 0; }
            }
        `;
        document.head.appendChild(style);
    })();
    </script>
</body>
</html>
